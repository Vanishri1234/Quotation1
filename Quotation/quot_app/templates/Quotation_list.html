{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Quotation</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="{% static 'images/logo2.png' %}" type="image/x-icon">
    <link rel="apple-touch-icon" href="{% static 'images/logo2.png' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <!-- Start Main Top -->
    <div class="main-top">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <div class="right-phone-box">
                        <p>Call US :- <a href="#"> +91 702 203 886</a></p>
                    </div>
                    <div class="our-link">
                        <ul>
                            <li><a href="https://www.google.com/maps/place/Flower+Creeper+Legal,+HR+and+Allied+Business+Solutions/@15.3631641,75.1191101,15z/data=!4m6!3m5!1s0x3bb8d7f1c7b02705:0x8cc2a98e30832377!8m2!3d15.3631641!4d75.1191101!16s%2Fg%2F11mng3j1_r?entry=ttu"><i class="fas fa-location-arrow"></i> Our location</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <div class="login-box">
                        <p><a class="btn hvr-hover" href="{% url 'index' %}">LogOut</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Main Top -->

    <br>

    <!-- Start Main Top -->
    <header class="main-header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-default bootsnav">
            <div class="container">
                <div class="navbar-header">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbars-rs-food" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="fa fa-bars"></i>
                    </button>
                   <a class="navbar-brand" href="{% url 'index' %}">
                        <img src="{% static 'images/SBI.png' %}" alt="Logo" style="height: 120px;">
                    </a>
                </div>
                <div class="collapse navbar-collapse" id="navbar-menu">
                    <ul class="nav navbar-nav ml-auto" data-in="fadeInDown" data-out="fadeOutUp">
                        <li class="nav-item active"><a class="nav-link" href="{% url 'home_page' %}">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="">About Us</a></li>
                        <li class="dropdown">
                            <a href="#" class="nav-link dropdown-toggle arrow" data-toggle="dropdown">MASTERS</a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'company' %}">Company</a></li>
                                <li><a href="{% url 'customer' %}">Customer</a></li>
                                <li><a href="{% url 'uom' %}">UOM</a></li>
                                <li><a href="{% url 'item' %}">ITEM</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'customer_name' %}">Generate Quotation</a></li>
                        <li class="dropdown">
                            <a href="#" class="nav-link dropdown-toggle arrow" data-toggle="dropdown">Lists</a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'customer_list' %}">Customer List</a></li>
                                <li><a href="{% url 'item_list' %}">Item List</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <br>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0"><b>Quotation List</b></h4>
            </div>
            <div class="card-body">
                <!-- Search Bar -->
                <div class="row search-bar mb-4">
                    <div class="col-md-4">
                        <input type="text" id="searchQuotNumber" class="form-control" placeholder="Search by Quot Number">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="searchCompany" class="form-control" placeholder="Search by Company Name">
                    </div>
                    <div class="col-md-4">
                        <button id="searchButton" class="btn btn-primary">Search</button>
                        <button id="resetButton" class="btn btn-secondary">Reset</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th scope="col">SI.NO</th>
                                <th scope="col">Quot Number</th>
                                <th scope="col">Company Name</th>
                                <th scope="col">Customer Name</th>
                                <th scope="col">Phone Number</th>
                                <th scope="col">GST Reg. Type</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for Quot in data %}
                                <tr id="row{{ Quot.id }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ Quot.quot_Number }}</td>
                                    <td>{{ Quot.companyName }}</td>
                                    <td>{{ Quot.customerName }}</td>
                                    <td>{{ Quot.phoneNumber }}</td>
                                    <td>{{ Quot.gstRegType }}</td>
                                    <td>
                                        <a href="{% url 'edit_quotation' Quot.id %}" class="btn btn-primary btn-sm">Edit</a>
                                       <a href="{% url 'receipt1' Quot.quot_Number %}" class="btn btn-primary btn-sm">Print</a>


                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">No quotations found.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery for handling search -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            // Search functionality
            $('#searchButton').click(function () {
                var quotNumber = $('#searchQuotNumber').val().trim().toLowerCase();
                var companyName = $('#searchCompany').val().trim().toLowerCase();
                $('tbody tr').each(function () {
                    var currentQuotNumber = $(this).find('td:nth-child(2)').text().trim().toLowerCase();
                    var currentCompanyName = $(this).find('td:nth-child(3)').text().trim().toLowerCase();
                    if ((quotNumber === "" || currentQuotNumber.includes(quotNumber)) &&
                        (companyName === "" || currentCompanyName.includes(companyName))) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });

            // Reset search filters
            $('#resetButton').click(function () {
                $('#searchQuotNumber').val('');
                $('#searchCompany').val('');
                $('tbody tr').show();
            });

            // Print functionality for specific row
            $('.print-button').click(function () {
                var rowId = $(this).data('row-id');
                var rowContent = $('#row' + rowId).html();

                var printWindow = window.open('', '', 'height=600,width=800');
                printWindow.document.write('<html><head><title>Print Quotation</title>');
                printWindow.document.write('<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">');
                printWindow.document.write('<style>table { width: 100%; } th, td { border: 1px solid #ddd; padding: 8px; } </style>');
                printWindow.document.write('</head><body >');
                printWindow.document.write('<h1>Quotation Details</h1>');
                printWindow.document.write('<table>' + rowContent + '</table>');
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
            });
        });

    </script>
</body>

</html>
